
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Container Lifecycle Hooks Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../related.html" />
    
    
    <link rel="prev" href="runtime.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    Overview
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../Overview/kubernetes.html">
            
                <a href="../Overview/kubernetes.html">
            
                    
                    What is Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../Overview/components.html">
            
                <a href="../Overview/components.html">
            
                    
                    Kubernetes Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../Overview/api.html">
            
                <a href="../Overview/api.html">
            
                    
                    The Kubernetes API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" >
            
                <span>
            
                    
                    Objects
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.4.1" data-path="../Overview/Objects/objs.html">
            
                <a href="../Overview/Objects/objs.html">
            
                    
                    Understanding Kubernetes Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.2" data-path="../Overview/Objects/names.html">
            
                <a href="../Overview/Objects/names.html">
            
                    
                    Names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.3" data-path="../Overview/Objects/namespaces.html">
            
                <a href="../Overview/Objects/namespaces.html">
            
                    
                    Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.4" data-path="../Overview/Objects/labels.html">
            
                <a href="../Overview/Objects/labels.html">
            
                    
                    Labels and Selectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.5" data-path="../Overview/Objects/annotations.html">
            
                <a href="../Overview/Objects/annotations.html">
            
                    
                    Annotations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.6" data-path="../Overview/Objects/field.html">
            
                <a href="../Overview/Objects/field.html">
            
                    
                    Field Selectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4.7" data-path="../Overview/Objects/recLabels.html">
            
                <a href="../Overview/Objects/recLabels.html">
            
                    
                    Recommended Labels
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" >
            
                <span>
            
                    
                    manage
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.5.1" data-path="../Overview/manage/kom.html">
            
                <a href="../Overview/manage/kom.html">
            
                    
                    Kubernetes Object Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5.2" data-path="../Overview/manage/commans.html">
            
                <a href="../Overview/manage/commans.html">
            
                    
                    Managing Kubernetes Objects Using Imperative Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5.3" data-path="../Overview/manage/configuration.html">
            
                <a href="../Overview/manage/configuration.html">
            
                    
                    Imperative Management of Kubernetes Objects Using Configuration Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5.4" data-path="../Overview/manage/declarative.html">
            
                <a href="../Overview/manage/declarative.html">
            
                    
                    Declarative Management of Kubernetes Objects Using Configuration Files
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    Policies
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../Policies/resourceQuotas.html">
            
                <a href="../Policies/resourceQuotas.html">
            
                    
                    Resource Quotas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../Policies/podSecPolicy.html">
            
                <a href="../Policies/podSecPolicy.html">
            
                    
                    Pod Security Policies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../Configuration/configureBestPractices.html">
            
                <a href="../Configuration/configureBestPractices.html">
            
                    
                    Configuration Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../Configuration/containerResources.html">
            
                <a href="../Configuration/containerResources.html">
            
                    
                    Managing Compute Resources for Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../Configuration/podAssign.html">
            
                <a href="../Configuration/podAssign.html">
            
                    
                    Assigning Pods to Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../Configuration/tt.html">
            
                <a href="../Configuration/tt.html">
            
                    
                    Taints and Tolerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../Configuration/secrets.html">
            
                <a href="../Configuration/secrets.html">
            
                    
                    Secrets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../Configuration/ocaukf.html">
            
                <a href="../Configuration/ocaukf.html">
            
                    
                    Organizing Cluster Access Using kubeconfig Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.7" data-path="../Configuration/ppp.html">
            
                <a href="../Configuration/ppp.html">
            
                    
                    Pod Priority and Preemption
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" >
            
                <span>
            
                    
                    Containers
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="images.html">
            
                <a href="images.html">
            
                    
                    Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="envs.html">
            
                <a href="envs.html">
            
                    
                    Container Environment Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="runtime.html">
            
                <a href="runtime.html">
            
                    
                    Runtime Class
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4.4" data-path="lifecycle.html">
            
                <a href="lifecycle.html">
            
                    
                    Container Lifecycle Hooks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../related.html">
            
                <a href="../../related.html">
            
                    
                    Related
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../Related/borg.html">
            
                <a href="../../Related/borg.html">
            
                    
                    Borg
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Container Lifecycle Hooks</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x5BB9;&#x5668;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;">&#x5BB9;&#x5668;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;</h1>
<h2 id="&#x6982;&#x8981;">&#x6982;&#x8981;</h2>
<p>&#x548C;&#x8BB8;&#x591A;&#x5177;&#x6709;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x4E49;&#x6846;&#x67B6;&#x4E00;&#x6837;&#xFF0C;kubernetes&#x4E3A;&#x5BB9;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;&#x3002;&#x94A9;&#x5B50;&#x8BA9;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5176;&#x7BA1;&#x7406;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;&#x65F6;&#x8FD0;&#x884C;&#x5728;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x548C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#x3002;</p>
<h2 id="&#x5BB9;&#x5668;&#x94A9;&#x5B50;">&#x5BB9;&#x5668;&#x94A9;&#x5B50;</h2>
<p>&#x5BB9;&#x5668;&#x4E2D;&#x66B4;&#x9732;&#x4E86;&#x4E24;&#x4E2A;&#x94A9;&#x5B50;&#xFF1A;</p>
<pre><code>PostStart
</code></pre><p>&#x8FD9;&#x4E2A;&#x94A9;&#x5B50;&#x5728;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x540E;&#x7ACB;&#x5373;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4FDD;&#x8BC1;&#x5728;&#x5BB9;&#x5668;<code>ENTRYPOINT</code>&#x4E4B;&#x524D;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x94A9;&#x5B50;&#x3002;&#x4E0D;&#x4F1A;&#x5411;&#x5904;&#x7406;&#x5668;&#x4F20;&#x9012;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#x3002;</p>
<pre><code>PreStop
</code></pre><p>&#x8FD9;&#x4E2A;&#x94A9;&#x5B50;&#x5728;API &#x8BF7;&#x6C42;&#x6216;&#x7BA1;&#x7406;&#x4E8B;&#x4EF6;&#xFF08;&#x5B58;&#x6D3B;&#x63A2;&#x9488;&#x68C0;&#x67E5;&#x5931;&#x8D25;&#xFF0C;&#x62A2;&#x5360;&#xFF0C;&#x8D44;&#x6E90;&#x4E89;&#x593A;&#x7B49;&#xFF09;&#x5BFC;&#x81F4;&#x7684;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x4E4B;&#x524D;&#x7ACB;&#x5373;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x7684;&#x72B6;&#x6001;&#x4E3A;&#x5DF2;&#x505C;&#x6B62;&#x6216;&#x5DF2;&#x5B8C;&#x6210;&#xFF0C;preStop&#x94A9;&#x5B50;&#x7684;&#x8C03;&#x7528;&#x4F1A;&#x5931;&#x8D25;&#x3002;&#x94A9;&#x5B50;&#x7684;&#x8C03;&#x7528;&#x4E3A;&#x963B;&#x585E;&#x5F0F;&#xFF08;&#x540C;&#x6B65;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x53D1;&#x9001;&#x5220;&#x9664;&#x5BB9;&#x5668;&#x547D;&#x4EE4;&#x524D;&#xFF0C;&#x94A9;&#x5B50;&#x6267;&#x884C;&#x5FC5;&#x987B;&#x7ED3;&#x675F;&#x3002;&#x540C;&#x6837;&#x4E0D;&#x4F1A;&#x5411;&#x5904;&#x7406;&#x5668;&#x4F20;&#x9012;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#x3002;</p>
<h3 id="&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#x5B9E;&#x73B0;">&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#x5B9E;&#x73B0;</h3>
<p>&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x548C;&#x6CE8;&#x518C;&#x8BE5;&#x94A9;&#x5B50;&#x7684;&#x5904;&#x7406;&#x5668;&#x6765;&#x8BBF;&#x95EE;&#x94A9;&#x5B50;&#x3002;&#x53EF;&#x4EE5;&#x4E3A;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#xFF1A;</p>
<ul>
<li>Exec - &#x5728;&#x5BB9;&#x5668;&#x7684;cgroups&#x548C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x547D;&#x4EE4;&#xFF0C;&#x4F8B;&#x5982;pre-stop.sh&#x3002;</li>
<li>HTTP - &#x5BF9;Container&#x4E0A;&#x7684;&#x7279;&#x5B9A;&#x7AEF;&#x70B9;&#x6267;&#x884C;HTTP&#x8BF7;&#x6C42;&#x3002;</li>
</ul>
<h3 id="&#x6267;&#x884C;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;">&#x6267;&#x884C;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;</h3>
<p>&#x5F53;&#x5BB9;&#x5668;&#x751F;&#x547D;&#x5468;&#x671F;&#x94A9;&#x5B50;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;Kubernetes&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4F1A;&#x6267;&#x884C;&#x5BB9;&#x5668;&#x5185;&#x5411;&#x8BE5;&#x94A9;&#x5B50;&#x6CE8;&#x518C;&#x7684;&#x5904;&#x7406;&#x5668;&#x3002;</p>
<p><del>Hook handler calls are synchronous within the context of the Pod containing the Container. This means that for a <code>PostStart</code>hook, the Container ENTRYPOINT and hook fire asynchronously. However, if the hook takes too long to run or hangs, the Container cannot reach a <code>running</code> state.</del></p>
<p>&#x5728;&#x5305;&#x542B;&#x5BB9;&#x5668;Pod&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x7684;&#x8C03;&#x7528;&#x662F;&#x540C;&#x6B65;&#x7684;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5BF9;<code>postStart</code> &#x94A9;&#x5B50;&#xFF0C;&#x5BB9;&#x5668; <code>ENTRYPOINT</code> &#x548C;&#x94A9;&#x5B50;&#x8C03;&#x7528;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x94A9;&#x5B50;&#x9700;&#x8981;&#x5F88;&#x957F;&#x7684;&#x6267;&#x884C;&#x4E8B;&#x4EF6;&#x6216;&#x88AB;&#x6302;&#x4F4F;&#xFF0C;&#x5BB9;&#x5668;&#x5C31;&#x4E0D;&#x80FD;&#x5904;&#x4E8E; <code>running</code> &#x72B6;&#x6001;&#x3002; </p>
<p><del>The behavior is similar for a <code>PreStop</code> hook. If the hook hangs during execution, the Pod phase stays in a <code>Terminating</code> state and is killed after <code>terminationGracePeriodSeconds</code> of pod ends. If a <code>PostStart</code> or <code>PreStop</code> hook fails, it kills the Container.</del></p>
<p><code>PreStop</code> &#x94A9;&#x5B50;&#x7684;&#x884C;&#x4E3A;&#x4E0E; <code>PostStart</code> &#x7C7B;&#x4F3C;&#x3002;&#x5982;&#x679C;&#xFF0C;&#x94A9;&#x5B50;&#x5728;&#x6267;&#x884C;&#x671F;&#x95F4;&#x88AB;&#x6302;&#x4F4F;&#xFF0C;Pod&#x7684;&#x72B6;&#x6001;&#x5C06;&#x4E00;&#x76F4;&#x4FDD;&#x7559;&#x5728; <code>Terminating</code> &#x72B6;&#x6001;&#xFF0C;pod&#x7EC8;&#x6B62;&#x540E;&#x7ECF;&#x8FC7;  <code>terminationGracePeriodSeconds</code>  &#x65F6;&#x95F4;&#x540E;&#x5BB9;&#x5668;&#x5C06;&#x88AB;&#x6740;&#x6B7B;&#x3002;&#x5982;&#x679C; <code>PostStart</code>&#x6216; <code>PreStop</code> &#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x88AB;&#x6740;&#x6389;&#x3002; </p>
<p><del>Users should make their hook handlers as lightweight as possible. There are cases, however, when long running commands make sense, such as when saving state prior to stopping a Container.</del></p>
<p>&#x7528;&#x6237;&#x5E94;&#x5F53;&#x5C06;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#x8BBE;&#x8BA1;&#x7684;&#x5C3D;&#x53EF;&#x80FD;&#x7B80;&#x5355;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x957F;&#x65F6;&#x95F4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x662F;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x4E4B;&#x524D;&#x4FDD;&#x5B58;&#x72B6;&#x6001;&#x3002;</p>
<h3 id="&#x94A9;&#x5B50;&#x4F20;&#x9012;&#x4FDD;&#x8BC1;">&#x94A9;&#x5B50;&#x4F20;&#x9012;&#x4FDD;&#x8BC1;</h3>
<p><del>Hook delivery is intended to be <em>at least once</em>, which means that a hook may be called multiple times for any given event, such as for <code>PostStart</code> or <code>PreStop</code>. It is up to the hook implementation to handle this correctly.</del></p>
<p>&#x94A9;&#x5B50;&#x7684;&#x4F20;&#x9012;&#x4FDD;&#x8BC1;&#x81F3;&#x5C11;&#x4E00;&#x6B21;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5BF9;&#x4E8E;&#x7ED9;&#x5B9A;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x94A9;&#x5B50;&#x53EF;&#x80FD;&#x88AB;&#x6267;&#x884C;&#x591A;&#x6B21;&#xFF0C;&#x6BD4;&#x5982;  <code>PostStart</code> &#x6216; <code>PreStop</code> &#x3002;&#x94A9;&#x5B50;&#x5B9E;&#x73B0;&#x9700;&#x8981;&#x5904;&#x7406;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;</p>
<p><del>Generally, only single deliveries are made. If, for example, an HTTP hook receiver is down and is unable to take traffic, there is no attempt to resend. In some rare cases, however, double delivery may occur. For instance, if a kubelet restarts in the middle of sending a hook, the hook might be resent after the kubelet comes back up.</del></p>
<p>&#x901A;&#x5E38;&#xFF0C;&#x9700;&#x8981;&#x4EC5;&#x4F20;&#x9012;&#x4E00;&#x6B21;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;HTTP&#x94A9;&#x5B50;&#x63A5;&#x6536;&#x5668;&#x5DF2;&#x7ECF;&#x5173;&#x95ED;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6D41;&#x91CF;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x53D1;&#x9001;&#x3002;&#x5728;&#x4E00;&#x4E9B;&#x5C11;&#x89C1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E24;&#x6B21;&#x4F20;&#x9012;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x94A9;&#x5B50;&#x4F20;&#x9012;&#x8FC7;&#x7A0B;&#x4E2D;kubelet&#x91CD;&#x542F;&#xFF0C;&#x5F53;kubelet&#x91CD;&#x542F;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x94A9;&#x5B50;&#x53EF;&#x80FD;&#x88AB;&#x518D;&#x6B21;&#x4F20;&#x9012;&#x3002;</p>
<h3 id="&#x8C03;&#x8BD5;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;">&#x8C03;&#x8BD5;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;</h3>
<p><del>The logs for a Hook handler are not exposed in Pod events. If a handler fails for some reason, it broadcasts an event. For <code>PostStart</code>, this is the <code>FailedPostStartHook</code> event, and for <code>PreStop</code>, this is the <code>FailedPreStopHook</code> event. You can see these events by running <code>kubectl describe pod &lt;pod_name&gt;</code>. Here is some example output of events from running this command:</del></p>
<p>&#x5728;Pod&#x7684;&#x4E8B;&#x4EF6;&#x4E2D;&#x4E0D;&#x4F1A;&#x5305;&#x62EC;&#x94A9;&#x5B50;&#x5904;&#x7406;&#x5668;&#x65E5;&#x5FD7;&#x3002;&#x5982;&#x679C;&#x56E0;&#x4E3A;&#x67D0;&#x4E9B;&#x539F;&#x56E0;&#x5904;&#x7406;&#x5668;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x4E8B;&#x4EF6;&#x5C06;&#x4F1A;&#x88AB;&#x5E7F;&#x64AD;&#x3002;&#x5BF9;&#x4E8E; <code>PostStart</code> &#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; <code>FailedPostStartHook</code> &#x4E8B;&#x4EF6;&#xFF0C;<code>PreStop</code> &#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; <code>FailedPreStopHook</code>  &#x4E8B;&#x4EF6;&#x3002;&#x901A;&#x8FC7; <code>kubectl describe pod &lt;pod_name&gt;</code> &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x6837;&#x4F8B;&#x7684;&#x8F93;&#x51FA;&#xFF1A;</p>
<pre><code>Events:
  FirstSeen  LastSeen  Count  From                                                   SubobjectPath          Type      Reason               Message
  ---------  --------  -----  ----                                                   -------------          --------  ------               -------
  1m         1m        1      {default-scheduler }                                                          Normal    Scheduled            Successfully assigned test-1730497541-cq1d2 to gke-test-cluster-default-pool-a07e5d30-siqd
  1m         1m        1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Pulling              pulling image &quot;test:1.0&quot;
  1m         1m        1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Created              Created container with docker id 5c6a256a2567; Security:[seccomp=unconfined]
  1m         1m        1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Pulled               Successfully pulled image &quot;test:1.0&quot;
  1m         1m        1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Started              Started container with docker id 5c6a256a2567
  38s        38s       1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Killing              Killing container with docker id 5c6a256a2567: PostStart handler: Error executing in Docker Container: 1
  37s        37s       1      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Normal    Killing              Killing container with docker id 8df9fdfd7054: PostStart handler: Error executing in Docker Container: 1
  38s        37s       2      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}                         Warning   FailedSync           Error syncing pod, skipping: failed to &quot;StartContainer&quot; for &quot;main&quot; with RunContainerError: &quot;PostStart handler: Error executing in Docker Container: 1&quot;
  1m         22s       2      {kubelet gke-test-cluster-default-pool-a07e5d30-siqd}  spec.containers{main}  Warning   FailedPostStartHook
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="runtime.html" class="navigation navigation-prev " aria-label="Previous page: Runtime Class">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../related.html" class="navigation navigation-next " aria-label="Next page: Related">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Container Lifecycle Hooks","level":"1.2.4.4","depth":3,"next":{"title":"Related","level":"1.3","depth":1,"path":"related.md","ref":"related.md","articles":[{"title":"Borg","level":"1.3.1","depth":2,"path":"Related/borg.md","ref":"Related/borg.md","articles":[]}]},"previous":{"title":"Runtime Class","level":"1.2.4.3","depth":3,"path":"Concepts/Containers/runtime.md","ref":"Concepts/Containers/runtime.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Concepts/Containers/lifecycle.md","mtime":"2019-03-10T14:55:51.582Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-14T11:39:08.635Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

